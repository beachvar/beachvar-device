services:
  device:
    build: .
    command: python -O main.py
    env_file:
      - .env
    environment:
      # SSH config for web terminal (access to host)
      - SSH_HOST=localhost
      - SSH_USER=device
      - SSH_PORT=22
      - SSH_KEY_PATH=/ssh/id_ed25519
    volumes:
      # Mount SSH key (will be copied with correct permissions by entrypoint)
      - /etc/beachvar/ssh_key:/ssh/id_ed25519.mount:ro
    devices:
      # GPIO access for Raspberry Pi button handling
      - /dev/gpiochip0:/dev/gpiochip0
    restart: unless-stopped
    # Use host network for SSH access to host machine
    network_mode: host
