services:
  device:
    build: .
    command: python -O main.py
    env_file:
      - .env
    environment:
      # SSH config for web terminal (access to host)
      - SSH_HOST=localhost
      - SSH_USER=device
      - SSH_PORT=22
      - SSH_KEY_PATH=/ssh/id_ed25519
    volumes:
      # Mount SSH key for passwordless authentication to host
      - /etc/beachvar/ssh_key:/ssh/id_ed25519:ro
    ports:
      - "8080:8080"   # Main HTTP server
      - "7682:7682"   # ttyd web terminal
    restart: unless-stopped
    # Use host network for SSH access to host machine
    network_mode: host
