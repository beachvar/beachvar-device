services:
  device:
    build: .
    command: python -O main.py
    env_file:
      - .env
    environment:
      # SSH config for web terminal (access to host)
      - SSH_HOST=localhost
      - SSH_USER=device
      - SSH_PORT=22
      - SSH_KEY_PATH=/ssh/id_ed25519
      # Cloudflared tunnel hostname (from .env: TUNNEL_HOSTNAME)
      - TUNNEL_HOSTNAME=${TUNNEL_HOSTNAME:-}
    volumes:
      # Mount SSH key (will be copied with correct permissions by entrypoint)
      - /etc/beachvar/ssh_key:/ssh/id_ed25519.mount:ro
    restart: unless-stopped
    # Use host network for SSH access to host machine
    network_mode: host
